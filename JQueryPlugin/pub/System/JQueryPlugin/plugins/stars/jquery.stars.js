(function(e){var t={split:1,numStars:5,widthStar:16};function n(n,s){var i=this;i.elem=e(n);i.opts=e.extend({},t,s);i.init()}function s(e){return e.constructor===Object}function i(e){return e.constructor===Array}function o(e){return e.constructor===String}n.prototype._toFixed=function(e){e=Number(e);return Number(e.toFixed(this._prec))};n.prototype.init=function(){var t=this,n,a;t.mapping={};if(t.opts.values){if(o(t.opts.values)){t.opts.values=t.opts.values.split(/\s*,\s*/)}else if(i(t.opts.values)){a=[];e.each(t.opts.values,function(e,i){if(s(i)){for(n in i){t.mapping[i[n]]=n;a.push(i[n])}}else{a.push(i)}});t.opts.values=a}t.opts.numStars=t.opts.values.length;t.opts.split=1}t.width=t.opts.numStars*t.opts.widthStar;t._prec=0;if(t.opts.split>1){t._prec++}if(t.opts.split>10){t._prec++}if(t.opts.split>100){t._prec++}t.blockMouseMove=false;t.timeoutId=undefined;t.elem.attr("type","hidden");t.container=e("<div />").addClass("jqStarsContainer").insertAfter(t.elem).width(t.width);t.labelElem=e("<span />").addClass("jqStarsLabel").insertAfter(t.container);t.onElem=e("<div />").addClass("jqStarsOn").appendTo(t.container);if(t.elem.is(":disabled")){t.container.addClass("jqStarsReadOnly")}else{t.deleteElem=e("<div />").addClass("jqStarsDelete").insertAfter(t.elem);t.container.on("mousemove",function(e){if(!t.blockMouseMove){t.displayAtIndex((e.clientX-t.container.position().left)/t.opts.widthStar)}});t.container.on("mouseleave",function(){if(t.blockMouseMove){if(typeof t.timeoutId!=="undefined"){window.clearTimeout(t.timeoutId)}t.timeoutId=window.setTimeout(function(){t.blockMouseMove=false;t.timeoutId=undefined},1e3)}t.display(t.elem.val());t.container.removeClass("jqStarsSelected")});t.container.on("mouseenter",function(){t.blockMouseMove=false});t.container.on("click",function(e){t.displayAtIndex((e.clientX-t.container.position().left)/t.opts.widthStar);t.container.addClass("jqStarsSelected");t.blockMouseMove=true;t.selectAtIndex(t._tmpIndex);return false});t.deleteElem.hover(function(){t.display()},function(){t.display(t.elem.val())});t.deleteElem.on("click",function(){t.select();return false});t.container.on("mousewheel",function(e){var n=1/t.opts.split;if(e.deltaY>0){t._tmpIndex+=n;if(t._tmpIndex>t.opts.numStars){t._tmpIndex=t.opts.numStars}}else{t._tmpIndex-=n;if(t._tmpIndex<0){t._tmpIndex=0}}t._tmpIndex=t._toFixed(t._tmpIndex);t.selectAtIndex(t._tmpIndex);t.container.addClass("jqStarsSelected");t.blockMouseMove=true;return false})}t.select(t.elem.val())};n.prototype.getDisplayVal=function(e){var t=this,n;if(t.opts.values){n=t.opts.values[e-1];if(typeof t.mapping[n]!=="undefined"){n=t.mapping[n]}}else{n=sprintf("%."+t._prec+"f",e)}return n};n.prototype.displayAtIndex=function(e){var t=this,n,s;if(typeof e==="undefined"||e===0){n=0;s=""}else{e=Math.ceil(e*t.opts.split)/t.opts.split;e=t._toFixed(e);n=t.opts.widthStar*e;s=t.getDisplayVal(e)}if(e==t._tmpIndex){return}t.onElem.width(n);t.labelElem.html(s);t._tmpIndex=e;t.elem.trigger("display.stars",e,s)};n.prototype.display=function(e){var t=this,n;if(typeof e==="undefined"||e===""||e==0){n=undefined}else if(typeof t.opts.values!=="undefined"){n=t.opts.values.indexOf(e)+1}else{n=e}t.displayAtIndex(n)};n.prototype.selectAtIndex=function(e){var t=this,n;t._tmpIndex=undefined;if(typeof e==="undefined"||e===0){n=""}else{if(typeof t.opts.values!=="undefined"){n=t.opts.values[e-1]}else{n=e}}t.displayAtIndex(e);t.elem.val(n)};n.prototype.select=function(e){var t=this;t._tmpIndex=undefined;t.display(e);t.elem.val(e)};e.fn.stars=function(t){return this.each(function(){if(!e.data(this,"_stars")){e.data(this,"_stars",new n(this,t))}})};e(function(){e(".jqStars:not(.jqInitedStars)").livequery(function(){var t=e(this),n=e.extend({},t.data(),t.metadata());t.stars(n).addClass("jqInitedStars")})})})(jQuery);